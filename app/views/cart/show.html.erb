<div class="card">
  <div class="section-header">
    <h1>Your cart</h1>
    <p class="section-subtitle">
      Review your badminton gear before you check out.
    </p>
  </div>

  <% if @cart_items.empty? %>
    <p>Your cart is empty for now.</p>
    <p class="text-muted">
      Add a racquet or some accessories to start your order.
    </p>
    <%= link_to "Browse racquets", products_path, class: "btn btn-primary" %>
  <% else %>
    <table class="table">
      <thead>
        <tr>
          <th>Product</th>
          <th>Qty</th>
          <th>Unit price</th>
          <th>Subtotal</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% total = 0 %>
        <% @cart_items.each do |item| %>
          <% product = item[:product] %>
          <% qty = item[:quantity] %>
          <% subtotal = item[:subtotal] %>
          <% total += subtotal %>
          <tr>
            <td>
              <strong><%= link_to product.name, product_path(product) %></strong>
              <div class="text-muted">
                <%= truncate(product.description, length: 80) %>
              </div>
            </td>
            <td>
              <%= form_with url: update_cart_item_path(product),
                            method: :patch,
                            local: true,
                            class: "inline-form" do |f| %>
                <%= f.number_field :quantity, value: qty, min: 1, style: "max-width: 70px;" %>
                <%= f.submit "Update", class: "btn btn-secondary btn-small mt-1" %>
              <% end %>
            </td>
            <td><%= number_to_currency(product.effective_price) %></td>
            <td><%= number_to_currency(subtotal) %></td>
            <td class="text-right">
              <%= button_to "Remove",
                            remove_from_cart_path(product),
                            method: :delete,
                            data: { confirm: "Remove this item?" },
                            class: "btn btn-danger btn-small" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <% subtotal_sum = total %>

<div class="order-summary card">
  <div class="section-header">
    <h2>Order summary</h2>
    <p class="section-subtitle">
      Review your items before continuing to checkout.
    </p>
  </div>

      <table class="table">
    <tbody>
      <tr class="order-summary-row">
        <th>Items subtotal</th>
        <td class="text-right"><%= number_to_currency(subtotal_sum) %></td>
      </tr>
    </tbody>
  </table>

      <div class="text-right">
    <%= link_to "Proceed to checkout", new_order_path, class: "btn btn-primary" %>
    <%= button_to "Clear cart",
                  clear_cart_path,
                  method: :delete,
                  class: "btn btn-secondary" %>
  </div>
    </div>
  <% end %>
</div>
